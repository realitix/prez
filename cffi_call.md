### Call a C API from Python becomes more enjoyable with CFFI

<br />
#### Jean-SÃ©bastien Bevilacqua

<img src="img/pyparis.png" style="border:none" width=200>

<img src="img/linagora.png" style="border:none">

---

# Why Python extension ?

---

- Access low-level API (OpenGL, Vulkan) <!-- .element: class="fragment highlight-current-red" -->
- Re-use existing C library <!-- .element: class="fragment highlight-current-red" -->
- Improve performance <!-- .element: class="fragment fade-in" -->
<img src="img/fast_car.png" style="border:none">

---

## But Python extension in C...

- Reference counting <!-- .element: class="fragment highlight-current-red" -->
- Cumbersome CPython C API <!-- .element: class="fragment highlight-current-red" -->

And of course, our best friend... <!-- .element: class="fragment fade-in" -->
<img src="img/segfault.png" style="border:none">

---

## Solutions

- cython (Compilation, new syntax and toolchain) <!-- .element: class="fragment highlight-current-red" -->
- ctypes (Declaring C structures cumbersome and error prone) <!-- .element: class="fragment highlight-current-red" -->
- cffi (New/High-velocity) <!-- .element: class="fragment grow" -->

---

<!-- .slide: data-background-image="img/nebula.jpg" -->

## cffi revolution !

- 7 years old product, mature
- Alternative to ctypes (ABI mode)
- Alternative to cython (API mode)
- Compatible with CPython 2.x/3.x, Pypy

---

## ABI / API

- API
  - Faster
  - Safer
- ABI
  - Free of compiler
  - in-line

---

## First case: stb_image_resize

- C library to resize images
- Simple functions

---

## Second case: pyshaderc

 - C++ library to compile Glsl to SpirV
 - Build in two steps (static library/ cffi module)
 - Callback functions
 - setuptools integration

---

## Wrap deeper... Vulkan graphic API

 - Side by side comparison between C and cffi extension

---

## Autogenerated cdef

